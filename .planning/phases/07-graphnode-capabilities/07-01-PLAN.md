---
phase: 07-graphnode-capabilities
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [tests/test_graph.py]
autonomous: true

must_haves:
  truths:
    - "GraphNode.has_default_for() returns correct value from inner graph"
    - "GraphNode.get_default_for() retrieves default value from inner graph"
    - "GraphNode.get_input_type() returns type from inner graph node"
    - "GraphNode.get_output_type() returns type from inner graph node"
    - "GraphNode with bound inner graph values handled correctly"
  artifacts:
    - path: "tests/test_graph.py"
      provides: "GraphNode capability tests"
      contains: "class TestGraphNodeCapabilities"
  key_links:
    - from: "tests/test_graph.py"
      to: "src/hypergraph/nodes/graph_node.py"
      via: "test methods calling GraphNode.has_default_for, get_default_for, get_input_type"
      pattern: "\.has_default_for|\.get_default_for|\.get_input_type"
---

<objective>
Test GraphNode forwarding methods to verify they correctly delegate to the inner graph.

Purpose: Ensure GraphNode's universal capabilities (has_default_for, get_default_for, get_input_type, get_output_type) work correctly when a Graph is wrapped as a node.

Output: New test class `TestGraphNodeCapabilities` in tests/test_graph.py with comprehensive tests for all forwarding methods.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md

Source files:
@src/hypergraph/nodes/graph_node.py
@src/hypergraph/nodes/base.py
@tests/test_graph.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create TestGraphNodeCapabilities test class</name>
  <files>tests/test_graph.py</files>
  <action>
Add new test class `TestGraphNodeCapabilities` to test GraphNode forwarding methods.

**Location:** Add after `TestGraphNodeOutputAnnotation` class (around line 940).

**Tests to create:**

1. **test_has_default_for_with_default** - Inner graph has node with default, GraphNode.has_default_for returns True
   - Create inner graph with function that has default parameter `def foo(x: int, y: int = 10)`
   - Wrap as GraphNode
   - Assert `gn.has_default_for("y")` returns True

2. **test_has_default_for_without_default** - Inner graph node has no default, returns False
   - Create inner graph with function with no defaults `def foo(x: int)`
   - Wrap as GraphNode
   - Assert `gn.has_default_for("x")` returns False

3. **test_has_default_for_nonexistent_param** - Param not in inputs, returns False
   - Create inner graph
   - Assert `gn.has_default_for("nonexistent")` returns False

4. **test_get_default_for_retrieves_value** - Get actual default value from inner graph
   - Create inner graph with `def foo(x: int, y: int = 42)`
   - Assert `gn.get_default_for("y")` returns 42

5. **test_get_default_for_raises_on_no_default** - KeyError when param has no default
   - Create inner graph with `def foo(x: int)`
   - Assert `gn.get_default_for("x")` raises KeyError with message mentioning "x"

6. **test_get_input_type_returns_type** - Returns type annotation from inner graph node
   - Create inner graph with `def foo(x: int, y: str)`
   - Assert `gn.get_input_type("x")` returns `int`
   - Assert `gn.get_input_type("y")` returns `str`

7. **test_get_input_type_untyped_returns_none** - Returns None for untyped params
   - Create inner graph with `def foo(x)`
   - Assert `gn.get_input_type("x")` returns None

8. **test_get_input_type_nonexistent_returns_none** - Returns None for nonexistent param
   - Assert `gn.get_input_type("nonexistent")` returns None

9. **test_get_output_type_returns_type** - Returns output type from inner graph node
   - Create inner graph with `def foo(x: int) -> str`
   - Assert `gn.get_output_type("result")` returns `str`

10. **test_get_output_type_untyped_returns_none** - Returns None for untyped output
    - Create inner graph with `def foo(x)`
    - Assert `gn.get_output_type("result")` returns None

**Pattern:** Use `@node` decorator for inline test functions. Follow existing test style from `TestGraphNodeOutputAnnotation`.

**Note on current behavior:** GraphNode does NOT currently override has_default_for/get_default_for (uses HyperNode defaults). Tests for GNODE-01/GNODE-02 will fail until GraphNode is updated to forward these methods. This is expected - tests document the expected behavior.
  </action>
  <verify>uv run pytest tests/test_graph.py::TestGraphNodeCapabilities -v</verify>
  <done>
- TestGraphNodeCapabilities class exists with 10 test methods
- Tests for get_input_type and get_output_type pass (GraphNode implements these)
- Tests for has_default_for and get_default_for may fail (expected - documents gap)
- All tests run without syntax errors
  </done>
</task>

<task type="auto">
  <name>Task 2: Add tests for bound inner graph values</name>
  <files>tests/test_graph.py</files>
  <action>
Add tests for GNODE-05: GraphNode with bound values from inner graph.

**Add to TestGraphNodeCapabilities:**

11. **test_bound_inner_graph_excludes_bound_from_inputs** - Bound values not in GraphNode.inputs
    - Create inner graph with `def foo(x: int, y: int)`
    - Bind y=10: `bound_inner = inner.bind(y=10)`
    - Wrap as GraphNode: `gn = bound_inner.as_node()`
    - Assert `gn.inputs` does NOT include "y" (only "x")

12. **test_bound_inner_graph_preserves_unbound_inputs** - Unbound inputs still in GraphNode.inputs
    - Same setup as above
    - Assert `gn.inputs` includes "x"

13. **test_bound_value_not_accessible_via_has_default** - Bound is not same as default
    - Create inner graph, bind y=10
    - Wrap as GraphNode
    - Assert `gn.has_default_for("y")` returns False (y is not in inputs anymore, it's bound)

14. **test_nested_graphnode_with_bound_inner** - GraphNode of GraphNode with bound values
    - Create inner graph with defaults
    - Bind some values
    - Wrap as GraphNode
    - Use in outer graph
    - Verify types flow correctly

**Pattern:** Follow existing test style. Each test is self-contained with inline function definitions.
  </action>
  <verify>uv run pytest tests/test_graph.py::TestGraphNodeCapabilities -v</verify>
  <done>
- 4 additional tests for bound value handling
- Tests verify bound values are excluded from GraphNode.inputs
- Tests verify type forwarding works with bound inner graphs
- All tests run without errors
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `uv run pytest tests/test_graph.py::TestGraphNodeCapabilities -v` runs all tests
- [ ] No syntax errors in test file
- [ ] Test class follows existing patterns (docstrings, @node decorator usage)
- [ ] Tests cover all 5 GNODE requirements
</verification>

<success_criteria>

- TestGraphNodeCapabilities class exists with 14 test methods
- Tests cover: has_default_for, get_default_for, get_input_type, get_output_type, bound values
- Tests that pass document working functionality
- Tests that fail document gaps to be fixed (expected for has_default_for/get_default_for)
- No errors or warnings introduced
</success_criteria>

<output>
After completion, create `.planning/phases/07-graphnode-capabilities/07-01-SUMMARY.md`
</output>
